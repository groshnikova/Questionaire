<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Questions Practice</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Interview Questions Practice</h1>
            <p class="subtitle">Prepare for your next interview</p>
        </header>

        <div class="stats-panel" id="stats-panel">
            <div class="stat-item">
                <span class="stat-number" id="total-questions">0</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="answered-questions">0</span>
                <span class="stat-label">Answered</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="unanswered-questions">0</span>
                <span class="stat-label">Remaining</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="progress-percentage">0%</span>
                <span class="stat-label">Progress</span>
            </div>
        </div>

        <div class="controls">
            <div class="filter-group">
                <label for="category-filter">Category:</label>
                <select id="category-filter">
                    <option value="all">All Categories</option>
                </select>
            </div>
            <div class="filter-group">
                <label>
                    <input type="checkbox" id="unanswered-filter">
                    Show only unanswered
                </label>
            </div>
            <button id="add-question-btn" class="btn btn-primary">+ Add Question</button>
            <button id="reset-btn" class="btn btn-secondary">Reset Progress</button>
        </div>

        <div id="questions-container">
            <!-- Questions will be loaded here -->
        </div>

        <div id="practice-mode" class="practice-mode hidden">
            <div class="practice-header">
                <button id="exit-practice-btn" class="btn btn-secondary">Exit Practice</button>
                <span id="practice-counter">Question 1 of 10</span>
            </div>
            <div class="practice-card">
                <div class="practice-category" id="practice-category"></div>
                <div class="practice-question" id="practice-question"></div>
                <div class="practice-hint-section">
                    <button id="show-hint-btn" class="btn btn-hint">üí° Show Hint</button>
                    <div id="practice-hint" class="practice-hint hidden"></div>
                </div>
                <div class="practice-controls">
                    <button id="mark-answered-btn" class="btn btn-primary">Mark as Answered</button>
                    <button id="next-question-btn" class="btn btn-primary">Next Question</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Question Modal -->
    <div id="add-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Question</h2>
                <button class="modal-close" onclick="closeAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-category">Category:</label>
                    <select id="new-category">
                        <option value="Behavioral">Behavioral</option>
                        <option value="Technical">Technical</option>
                        <option value="HR">HR</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="new-question">Question:</label>
                    <textarea id="new-question" rows="3" placeholder="Enter your question..."></textarea>
                </div>
                <div class="form-group">
                    <label for="new-hint">Hint:</label>
                    <textarea id="new-hint" rows="3" placeholder="Enter a helpful hint..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewQuestion()">Add Question</button>
            </div>
        </div>
    </div>

    <!-- Edit Question Modal -->
    <div id="edit-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Question</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-question-id">
                <div class="form-group">
                    <label for="edit-category">Category:</label>
                    <select id="edit-category">
                        <option value="Behavioral">Behavioral</option>
                        <option value="Technical">Technical</option>
                        <option value="HR">HR</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-question">Question:</label>
                    <textarea id="edit-question" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-hint">Hint:</label>
                    <textarea id="edit-hint" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteQuestion()">Delete</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEditQuestion()">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        let allQuestions = [];
        let filteredQuestions = [];
        let practiceMode = false;
        let currentPracticeIndex = 0;

        // Load initial data
        async function init() {
            await loadCategories();
            await loadQuestions();
            await updateStats();
        }

        // Load categories
        async function loadCategories() {
            const response = await fetch('/api/categories');
            const categories = await response.json();

            const select = document.getElementById('category-filter');
            select.innerHTML = '<option value="all">All Categories</option>';

            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        // Load questions
        async function loadQuestions() {
            const category = document.getElementById('category-filter').value;
            const unansweredOnly = document.getElementById('unanswered-filter').checked;

            let url = '/api/questions?';
            if (category !== 'all') url += `category=${category}&`;
            if (unansweredOnly) url += 'unanswered=true';

            const response = await fetch(url);
            allQuestions = await response.json();
            filteredQuestions = allQuestions;

            displayQuestions();
        }

        // Display questions
        function displayQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            if (filteredQuestions.length === 0) {
                container.innerHTML = '<div class="no-questions">No questions found. Click "Add Question" to create one!</div>';
                return;
            }

            filteredQuestions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                if (q.answered) card.classList.add('answered');

                card.innerHTML = `
                    <div class="question-header">
                        <span class="question-category">${q.category || 'Uncategorized'}</span>
                        <div class="question-actions">
                            <button class="edit-btn" onclick="openEditModal(${q.id})" title="Edit">‚úèÔ∏è</button>
                            <button class="toggle-btn ${q.answered ? 'answered' : ''}" onclick="toggleAnswered(${q.id})">
                                ${q.answered ? '‚úì Answered' : '‚óã Not Answered'}
                            </button>
                        </div>
                    </div>
                    <div class="question-text">${q.question}</div>
                    ${q.hint ? `
                        <div class="hint-section">
                            <button class="hint-toggle-btn" onclick="toggleHint(${q.id})">üí° Show Hint</button>
                            <div id="hint-${q.id}" class="hint-text hidden">${q.hint}</div>
                        </div>
                    ` : ''}
                `;

                container.appendChild(card);
            });

            // Add practice button if there are questions
            if (filteredQuestions.length > 0) {
                const practiceBtn = document.createElement('button');
                practiceBtn.className = 'btn btn-primary practice-all-btn';
                practiceBtn.textContent = 'Practice These Questions';
                practiceBtn.onclick = startPractice;
                container.appendChild(practiceBtn);
            }
        }

        // Toggle hint visibility
        function toggleHint(questionId) {
            const hintElement = document.getElementById(`hint-${questionId}`);
            const button = event.target;

            if (hintElement.classList.contains('hidden')) {
                hintElement.classList.remove('hidden');
                button.textContent = 'üí° Hide Hint';
            } else {
                hintElement.classList.add('hidden');
                button.textContent = 'üí° Show Hint';
            }
        }

        // Toggle answered status
        async function toggleAnswered(questionId) {
            const response = await fetch(`/api/questions/${questionId}/toggle`, {
                method: 'POST'
            });

            if (response.ok) {
                await loadQuestions();
                await updateStats();
            }
        }

        // Update statistics
        async function updateStats() {
            const response = await fetch('/api/stats');
            const stats = await response.json();

            document.getElementById('total-questions').textContent = stats.total;
            document.getElementById('answered-questions').textContent = stats.answered;
            document.getElementById('unanswered-questions').textContent = stats.unanswered;
            document.getElementById('progress-percentage').textContent = stats.percentage + '%';
        }

        // Reset progress
        async function resetProgress() {
            if (!confirm('Are you sure you want to reset all progress?')) return;

            const response = await fetch('/api/reset', {
                method: 'POST'
            });

            if (response.ok) {
                await loadQuestions();
                await updateStats();
            }
        }

        // Open add question modal
        function openAddModal() {
            document.getElementById('add-modal').classList.remove('hidden');
            document.getElementById('new-category').value = 'Behavioral';
            document.getElementById('new-question').value = '';
            document.getElementById('new-hint').value = '';
        }

        // Close add question modal
        function closeAddModal() {
            document.getElementById('add-modal').classList.add('hidden');
        }

        // Save new question
        async function saveNewQuestion() {
            const category = document.getElementById('new-category').value;
            const question = document.getElementById('new-question').value.trim();
            const hint = document.getElementById('new-hint').value.trim();

            if (!question) {
                alert('Please enter a question');
                return;
            }

            const response = await fetch('/api/questions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ category, question, hint })
            });

            if (response.ok) {
                closeAddModal();
                await loadCategories();
                await loadQuestions();
                await updateStats();
            }
        }

        // Open edit question modal
        function openEditModal(questionId) {
            const question = allQuestions.find(q => q.id === questionId);
            if (!question) return;

            document.getElementById('edit-question-id').value = question.id;
            document.getElementById('edit-category').value = question.category;
            document.getElementById('edit-question').value = question.question;
            document.getElementById('edit-hint').value = question.hint || '';
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        // Close edit question modal
        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }

        // Save edited question
        async function saveEditQuestion() {
            const id = parseInt(document.getElementById('edit-question-id').value);
            const category = document.getElementById('edit-category').value;
            const question = document.getElementById('edit-question').value.trim();
            const hint = document.getElementById('edit-hint').value.trim();

            if (!question) {
                alert('Please enter a question');
                return;
            }

            const response = await fetch(`/api/questions/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ category, question, hint })
            });

            if (response.ok) {
                closeEditModal();
                await loadCategories();
                await loadQuestions();
                await updateStats();
            }
        }

        // Delete question
        async function deleteQuestion() {
            if (!confirm('Are you sure you want to delete this question?')) return;

            const id = parseInt(document.getElementById('edit-question-id').value);

            const response = await fetch(`/api/questions/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                closeEditModal();
                await loadCategories();
                await loadQuestions();
                await updateStats();
            }
        }

        // Start practice mode
        function startPractice() {
            if (filteredQuestions.length === 0) return;

            practiceMode = true;
            currentPracticeIndex = 0;

            document.getElementById('questions-container').style.display = 'none';
            document.getElementById('practice-mode').classList.remove('hidden');

            showPracticeQuestion();
        }

        // Show current practice question
        function showPracticeQuestion() {
            if (currentPracticeIndex >= filteredQuestions.length) {
                exitPractice();
                alert('Practice session complete!');
                return;
            }

            const q = filteredQuestions[currentPracticeIndex];

            document.getElementById('practice-counter').textContent =
                `Question ${currentPracticeIndex + 1} of ${filteredQuestions.length}`;
            document.getElementById('practice-category').textContent = q.category || 'Uncategorized';
            document.getElementById('practice-question').textContent = q.question;

            // Reset hint
            const hintElement = document.getElementById('practice-hint');
            hintElement.textContent = q.hint || 'No hint available';
            hintElement.classList.add('hidden');
            document.getElementById('show-hint-btn').textContent = 'üí° Show Hint';

            const markBtn = document.getElementById('mark-answered-btn');
            markBtn.textContent = q.answered ? '‚úì Answered' : 'Mark as Answered';
            markBtn.className = q.answered ? 'btn btn-success' : 'btn btn-primary';
        }

        // Toggle hint in practice mode
        function togglePracticeHint() {
            const hintElement = document.getElementById('practice-hint');
            const button = document.getElementById('show-hint-btn');

            if (hintElement.classList.contains('hidden')) {
                hintElement.classList.remove('hidden');
                button.textContent = 'üí° Hide Hint';
            } else {
                hintElement.classList.add('hidden');
                button.textContent = 'üí° Show Hint';
            }
        }

        // Mark current question as answered
        async function markCurrentAnswered() {
            const q = filteredQuestions[currentPracticeIndex];
            await toggleAnswered(q.id);

            // Update the current question in memory
            filteredQuestions[currentPracticeIndex].answered = !filteredQuestions[currentPracticeIndex].answered;
            showPracticeQuestion();
        }

        // Next question in practice
        function nextPracticeQuestion() {
            currentPracticeIndex++;
            showPracticeQuestion();
        }

        // Exit practice mode
        function exitPractice() {
            practiceMode = false;
            document.getElementById('practice-mode').classList.add('hidden');
            document.getElementById('questions-container').style.display = 'block';
            loadQuestions();
            updateStats();
        }

        // Event listeners
        document.getElementById('category-filter').addEventListener('change', loadQuestions);
        document.getElementById('unanswered-filter').addEventListener('change', loadQuestions);
        document.getElementById('reset-btn').addEventListener('click', resetProgress);
        document.getElementById('add-question-btn').addEventListener('click', openAddModal);
        document.getElementById('exit-practice-btn').addEventListener('click', exitPractice);
        document.getElementById('mark-answered-btn').addEventListener('click', markCurrentAnswered);
        document.getElementById('next-question-btn').addEventListener('click', nextPracticeQuestion);
        document.getElementById('show-hint-btn').addEventListener('click', togglePracticeHint);

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.add('hidden');
            }
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
